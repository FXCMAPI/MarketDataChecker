'use strict';
let AFxmsgReader = require('./AFxmsgReader.js');
let csvParser = require('@gehtsoft/LuaxStdlib-node').csvParser;
let DasUpdateMessageBuilder = require('./DasUpdateMessageBuilder.js');
let HeartbeatMessageBuilder = require('./HeartbeatMessageBuilder.js');
let PdasMessageFieldTag = require('./PdasMessageFieldTag.js');
let MessageBuilder = require('./MessageBuilder.js');
let PdasMessageType = require('./PdasMessageType.js');
class HeartbeatFxmsgReader extends AFxmsgReader {
    linesParser;
    dasUpdateMessageBuilder;
    constructor() {
        super();
        this.linesParser = new csvParser();
        this.linesParser.valueSeparator = "\n";
        this.dasUpdateMessageBuilder = new DasUpdateMessageBuilder();
    }
    createMessage(numSubscribedSymbolsStr, subscribedSymbolsCheckSum, requestId) {
        let messageBuilder;
        messageBuilder = new HeartbeatMessageBuilder();
        messageBuilder.setNumberOfSubscribedSymbols(numSubscribedSymbolsStr);
        messageBuilder.setSubscribedSymbolsCheckSum(subscribedSymbolsCheckSum);
        messageBuilder.setRequestId(requestId);
        return messageBuilder.build();
    }
    read(responseList, xmlRootNode, messages) {
        let i, requestId, numSubscribedSymbolsStr, subscribedSymbolsCheckSum;
        if (messages == null || messages.length == 0) {
            return;
        }
        for (i = 0; i <= messages.length - 1; i += 1) {
            if (messages[i].getType() == PdasMessageType.HEARTBEAT_MESSAGE && messages[i].getFieldValue(PdasMessageFieldTag.MSG_TYPE) == PdasMessageType.HEARTBEAT_MESSAGE) {
                requestId = messages[i].getFieldValue(PdasMessageFieldTag.TEST_REQUEST_ID);
                numSubscribedSymbolsStr = messages[i].getFieldValue(PdasMessageFieldTag.NUM_SUBSCRIBED_SYM);
                subscribedSymbolsCheckSum = messages[i].getFieldValue(PdasMessageFieldTag.FLD_TEXT);
                responseList.add(MessageBuilder.createLockedMessage(this.createMessage(numSubscribedSymbolsStr, subscribedSymbolsCheckSum, requestId)));
            }
        }
    }
}
module.exports = HeartbeatFxmsgReader
