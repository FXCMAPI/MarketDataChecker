'use strict';
let AFxmsgReader = require('./AFxmsgReader.js');
let PdasMessageFieldTag = require('./PdasMessageFieldTag.js');
let PdasRequestCommand = require('./PdasRequestCommand.js');
let ChangeOrderMessageBuilder = require('./ChangeOrderMessageBuilder.js');
let PdasMessageValue = require('./PdasMessageValue.js');
let stdlib = require('@gehtsoft/LuaxStdlib-node').stdlib;
let PdasMessageType = require('./PdasMessageType.js');
class ChangeOrderFxmsgReader extends AFxmsgReader {
    read(responseList, xmlRootNode, messages) {
        let i;
        if (messages == null || messages.length == 0) {
            return;
        }
        for (i = 0; i <= messages.length - 1; i += 1) {
            if (messages[i].getFieldValue(PdasMessageFieldTag.FXCM_COMMAND_ID) == PdasRequestCommand.CHANGE_ORDER && this.readMessage(responseList, messages[i])) {
                break;
            }
        }
    }
    readMessage(responseList, message) {
        let data, changeOrderMessageBuilder, listInstance;
        changeOrderMessageBuilder = new ChangeOrderMessageBuilder();
        if (message.getType() == PdasMessageType.FXCM_RESPONSE) {
            listInstance = message.getList(PdasMessageFieldTag.FXCM_NO_PARAM);
            if (listInstance != null) {
                data = listInstance.getGroupParamValueByParamName("DAS");
                if (data != null && stdlib.indexOf(data, "0", false) == 0) {
                    changeOrderMessageBuilder.setRequestTxt(listInstance.getGroupParamValueByParamName(PdasMessageValue.CLIENT_QTXT));
                    changeOrderMessageBuilder.setOrderId(listInstance.getGroupParamValueByParamName(PdasMessageValue.CLIENT_ORDER_ID));
                    responseList.add(this.createLockedMessage(changeOrderMessageBuilder.build()));
                    return true;
                }
            }
        } else if (message.getType() == PdasMessageType.FXCM_REJECT) {
            data = message.getFieldValue(PdasMessageFieldTag.FXCM_ERROR_DETAILS);
            if (data == null) {
                data = message.getFieldValue(PdasMessageFieldTag.FLD_TEXT);
            }
            if (data != null) {
                changeOrderMessageBuilder.setError(data);
                listInstance = message.getList(PdasMessageFieldTag.FXCM_NO_PARAM);
                if (listInstance != null) {
                    changeOrderMessageBuilder.setRequestTxt(listInstance.getGroupParamValueByParamName(PdasMessageValue.CLIENT_QTXT));
                    changeOrderMessageBuilder.setOrderId(listInstance.getGroupParamValueByParamName(PdasMessageValue.CLIENT_ORDER_ID));
                }
                responseList.add(this.createLockedMessage(changeOrderMessageBuilder.build()));
                return true;
            }
        }
        return false;
    }
}
module.exports = ChangeOrderFxmsgReader
